<!doctype html>
<html lang="vi" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·ª± l√†m T√†i ch√≠nh ƒë·ªÉ H·∫°nh Ph√∫c h∆°n</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="/_sdk/element_sdk.js"></script>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>

    <style>
        body { box-sizing: border-box; }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * { font-family: 'Inter', sans-serif; }
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }
        .glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }
        .celebrate {
            animation: celebrate 0.6s ease-in-out;
        }
        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] { -moz-appearance: textfield; }
        @view-transition { navigation: auto; }
    </style>
</head>
<body class="h-full">
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const defaultConfig = {
            app_title: "T·ª± l√†m T√†i ch√≠nh ƒë·ªÉ H·∫°nh Ph√∫c h∆°n",
            subtitle: "L·∫≠p k·∫ø ho·∫°ch cho t∆∞∆°ng lai t√†i ch√≠nh c·ªßa b·∫°n",
            freedom_day_label: "üéâ Ng√†y T·ª± do T√†i ch√≠nh",
            calculate_button: "T√≠nh To√°n Ngay",
            background_color: "#667eea",
            surface_color: "#ffffff",
            text_color: "#ffffff",
            primary_action_color: "#f093fb",
            secondary_action_color: "#764ba2"
        };

        function FinancialFreedomApp() {
            const [config, setConfig] = useState(defaultConfig);
            // ƒê√£ s·ª≠a l·ªói c√∫ ph√°p ·ªü d√≤ng n√†y
            const [initialCapital, setInitialCapital] = useState(100000000);
            const [monthlyContribution, setMonthlyContribution] = useState(10000000);
            const [annualRate, setAnnualRate] = useState(8);
            const [years, setYears] = useState(10);
            const [monthlyExpense, setMonthlyExpense] = useState(15000000);
            
            const [chartData, setChartData] = useState(null);
            const [freedomDay, setFreedomDay] = useState(null);
            const [totalAmount, setTotalAmount] = useState(0);
            const [totalInterest, setTotalInterest] = useState(0);
            const [showCelebration, setShowCelebration] = useState(false);
            
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            const formatCurrency = (num) => {
                return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(num);
            };

            const calculateInvestment = () => {
                const monthlyRate = annualRate / 100 / 12;
                const totalMonths = years * 12;
                const labels = [];
                const principalData = [];
                const interestData = [];
                const totalData = [];
                
                let principal = initialCapital;
                let freedomMonth = null;

                for (let month = 0; month <= totalMonths; month++) {
                    if (month > 0) {
                        const interest = principal * monthlyRate;
                        principal += interest + monthlyContribution;
                    }
                    
                    const totalPrincipal = initialCapital + (monthlyContribution * month);
                    const totalInterestAmount = principal - totalPrincipal;
                    
                    labels.push(month);
                    principalData.push(totalPrincipal);
                    interestData.push(totalInterestAmount);
                    totalData.push(principal);

                    if (!freedomMonth && totalInterestAmount * monthlyRate >= monthlyExpense) {
                        freedomMonth = month;
                    }
                }

                const finalAmount = principal;
                const finalInterest = finalAmount - (initialCapital + monthlyContribution * totalMonths);
                
                setTotalAmount(finalAmount);
                setTotalInterest(finalInterest);

                if (freedomMonth) {
                    const yearsPassed = Math.floor(freedomMonth / 12);
                    const monthsPassed = freedomMonth % 12;
                    setFreedomDay(`${yearsPassed} nƒÉm ${monthsPassed} th√°ng`);
                } else {
                    setFreedomDay(null);
                }

                if (finalAmount >= 1000000000 && !showCelebration) {
                    setShowCelebration(true);
                    setTimeout(() => setShowCelebration(false), 600);
                }

                setChartData({
                    labels,
                    datasets: [
                        {
                            label: 'V·ªën g·ªëc',
                            data: principalData,
                            borderColor: config.primary_action_color || defaultConfig.primary_action_color,
                            backgroundColor: `${config.primary_action_color || defaultConfig.primary_action_color}33`,
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'L√£i su·∫•t',
                            data: interestData,
                            borderColor: config.secondary_action_color || defaultConfig.secondary_action_color,
                            backgroundColor: `${config.secondary_action_color || defaultConfig.secondary_action_color}33`,
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'T·ªïng t√†i s·∫£n',
                            data: totalData,
                            borderColor: '#10b981',
                            backgroundColor: '#10b98133',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                });
            };

            useEffect(() => {
                calculateInvestment();
            }, []);

            useEffect(() => {
                if (chartData && chartRef.current) {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                    const ctx = chartRef.current.getContext('2d');
                    
                    // S·ª≠a l·∫°i c√°c key c·ªßa Chart.js t·ª´ ti·∫øng Vi·ªát sang ti·∫øng Anh ƒë·ªÉ th∆∞ vi·ªán hi·ªÉu
                    chartInstance.current = new Chart(ctx, {
                        type: 'line',
                        data: chartData,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            animation: { duration: 1000, easing: 'easeInOutQuart' },
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top',
                                    labels: { color: config.text_color || defaultConfig.text_color, font: { size: 12 } }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    title: { display: true, text: 'Th√°ng', color: config.text_color || defaultConfig.text_color },
                                    ticks: { color: config.text_color || defaultConfig.text_color },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                },
                                y: {
                                    title: { display: true, text: 'S·ªë ti·ªÅn (VNƒê)', color: config.text_color || defaultConfig.text_color },
                                    ticks: {
                                        color: config.text_color || defaultConfig.text_color,
                                        callback: function(value) { return (value / 1000000).toFixed(0) + 'M'; }
                                    },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' }
                                }
                            }
                        }
                    });
                }
                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                };
            }, [chartData, config]);

            // Ph·∫ßn SDK gi·ªØ nguy√™n logic
            useEffect(() => {
                if (window.elementSdk) {
                    window.elementSdk.init({
                        defaultConfig,
                        onConfigChange: async (newConfig) => {
                            setConfig(newConfig);
                            document.documentElement.style.background = `linear-gradient(135deg, ${newConfig.background_color || defaultConfig.background_color} 0%, ${newConfig.secondary_action_color || defaultConfig.secondary_action_color} 50%, ${newConfig.primary_action_color || defaultConfig.primary_action_color} 100%)`;
                        },
                        mapToCapabilities: (cfg) => ({
                            recolorables: [
                                { get: () => cfg.background_color || defaultConfig.background_color, set: (value) => { cfg.background_color = value; window.elementSdk.setConfig({ background_color: value }); } },
                                { get: () => cfg.surface_color || defaultConfig.surface_color, set: (value) => { cfg.surface_color = value; window.elementSdk.setConfig({ surface_color: value }); } },
                                { get: () => cfg.text_color || defaultConfig.text_color, set: (value) => { cfg.text_color = value; window.elementSdk.setConfig({ text_color: value }); } },
                                { get: () => cfg.primary_action_color || defaultConfig.primary_action_color, set: (value) => { cfg.primary_action_color = value; window.elementSdk.setConfig({ primary_action_color: value }); } },
                                { get: () => cfg.secondary_action_color || defaultConfig.secondary_action_color, set: (value) => { cfg.secondary_action_color = value; window.elementSdk.setConfig({ secondary_action_color: value }); } }
                            ],
                            borderables: [],
                            fontEditable: undefined,
                            fontSizeable: undefined
                        }),
                        mapToEditPanelValues: (cfg) => new Map([
                            ["app_title", cfg.app_title || defaultConfig.app_title],
                            ["subtitle", cfg.subtitle || defaultConfig.subtitle],
                            ["freedom_day_label", cfg.freedom_day_label || defaultConfig.freedom_day_label],
                            ["calculate_button", cfg.calculate_button || defaultConfig.calculate_button]
                        ])
                    });
                }
            }, []);

            return (
                <div className="min-h-full w-full gradient-bg overflow-auto">
                    <div className="w-full max-w-7xl mx-auto px-4 py-8">
                        <header className="text-center mb-8">
                            <h1 className="text-4xl md:text-5xl font-bold mb-2" style={{ color: config.text_color || defaultConfig.text_color }}>
                                {config.app_title || defaultConfig.app_title}
                            </h1>
                            <p className="text-lg opacity-90" style={{ color: config.text_color || defaultConfig.text_color }}>
                                {config.subtitle || defaultConfig.subtitle}
                            </p>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                            <div className="glass-effect rounded-2xl p-6">
                                <h2 className="text-2xl font-semibold mb-6" style={{ color: config.text_color || defaultConfig.text_color }}>
                                    üìä Th√¥ng Tin ƒê·∫ßu V√†o
                                </h2>
                                <div className="space-y-4">
                                    <div>
                                        <label htmlFor="initial-capital" className="block text-sm font-medium mb-2" style={{ color: config.text_color || defaultConfig.text_color }}>
                                            V·ªën ban ƒë·∫ßu (VNƒê)
                                        </label>
                                        <input id="initial-capital" type="number" value={initialCapital} onChange={(e) => setInitialCapital(Number(e.target.value))} className="w-full px-4 py-3 rounded-lg glass-effect text-white outline-none focus:ring-2 focus:ring-purple-400" style={{ color: config.text_color || defaultConfig.text_color }} />
                                    </div>
                                    <div>
                                        <label htmlFor="monthly-contribution" className="block text-sm font-medium mb-2" style={{ color: config.text_color || defaultConfig.text_color }}>
                                            ƒê√≥ng g√≥p h√†ng th√°ng (VNƒê)
                                        </label>
                                        <input id="monthly-contribution" type="number" value={monthlyContribution} onChange={(e) => setMonthlyContribution(Number(e.target.value))} className="w-full px-4 py-3 rounded-lg glass-effect text-white outline-none focus:ring-2 focus:ring-purple-400" style={{ color: config.text_color || defaultConfig.text_color }} />
                                    </div>
                                    <div> 
                                        <label htmlFor="annual-rate" className="block text-sm font-medium mb-2" style={{ color: config.text_color || defaultConfig.text_color }}>
                                            T·ª∑ l·ªá h√†ng nƒÉm (%)
                                        </label> 
                                        <input id="annual-rate" type="number" step="0.1" value={annualRate} onChange={(e) => setAnnualRate(Number(e.target.value))} className="w-full px-4 py-3 rounded-lg glass-effect text-white outline-none focus:ring-2 focus:ring-purple-400" style={{ color: config.text_color || defaultConfig.text_color }} /> 
                                    </div> 
                                    <div> 
                                        <label htmlFor="years" className="block text-sm font-medium mb-2" style={{ color: config.text_color || defaultConfig.text_color }}> 
                                            S·ªë nƒÉm 
                                        </label> 
                                        <input id="years" type="number" value={years} onChange={(e) => setYears(Number(e.target.value))} className="w-full px-4 py-3 rounded-lg glass-effect text-white outline-none focus:ring-2 focus:ring-purple-400" style={{ color: config.text_color || defaultConfig.text_color }} /> 
                                    </div> 
                                    <div> 
                                        <label htmlFor="monthly-expense" className="block text-sm font-medium mb-2" style={{ color: config.text_color || defaultConfig.text_color }}> 
                                            Chi ph√≠ h√†ng th√°ng m·ª•c ti√™u (VNƒê) 
                                        </label> 
                                        <input id="monthly-expense" type="number" value={monthlyExpense} onChange={(e) => setMonthlyExpense(Number(e.target.value))} className="w-full px-4 py-3 rounded-lg glass-effect text-white outline-none focus:ring-2 focus:ring-purple-400" style={{ color: config.text_color || defaultConfig.text_color }} /> 
                                    </div>
                                    <button onClick={calculateInvestment} className="w-full py-3 px-6 rounded-lg font-semibold text-white glow transition-transform hover:scale-105 active:scale-95" style={{ backgroundColor: config.primary_action_color || defaultConfig.primary_action_color }}>
                                        {config.calculate_button || defaultConfig.calculate_button}
                                    </button>
                                </div>
                            </div>

                            <div className="glass-effect rounded-2xl p-6">
                                <h2 className="text-2xl font-semibold mb-6" style={{ color: config.text_color || defaultConfig.text_color }}>
                                    üí∞ K·∫øt Qu·∫£
                                </h2>
                                <div className="space-y-4">
                                    <div className={`p-4 rounded-lg ${showCelebration ? 'celebrate' : ''}`} style={{ backgroundColor: 'rgba(255, 255, 255, 0.1)' }}>
                                        <div className="text-sm opacity-75 mb-1" style={{ color: config.text_color || defaultConfig.text_color }}>
                                            T·ªïng t√†i s·∫£n
                                        </div>
                                        <div className="text-3xl font-bold" style={{ color: config.text_color || defaultConfig.text_color }}>
                                            {formatCurrency(totalAmount)}
                                        </div>
                                    </div>
                                    <div className="p-4 rounded-lg" style={{ backgroundColor: 'rgba(255, 255, 255, 0.1)' }}>
                                        <div className="text-sm opacity-75 mb-1" style={{ color: config.text_color || defaultConfig.text_color }}>
                                            T·ªïng l√£i su·∫•t ki·∫øm ƒë∆∞·ª£c
                                        </div>
                                        <div className="text-2xl font-bold" style={{ color: config.text_color || defaultConfig.text_color }}>
                                            {formatCurrency(totalInterest)}
                                        </div>
                                    </div>
                                    {freedomDay && (
                                        <div className="p-4 rounded-lg glow" style={{ backgroundColor: config.primary_action_color || defaultConfig.primary_action_color }}>
                                            <div className="text-sm font-semibold mb-1" style={{ color: config.text_color || defaultConfig.text_color }}>
                                                {config.freedom_day_label || defaultConfig.freedom_day_label}
                                            </div>
                                            <div className="text-2xl font-bold" style={{ color: config.text_color || defaultConfig.text_color }}>
                                                {freedomDay}
                                            </div>
                                            <div className="text-xs mt-2 opacity-90" style={{ color: config.text_color || defaultConfig.text_color }}>
                                                Thu nh·∫≠p th·ª• ƒë·ªông v∆∞·ª£t chi ph√≠ h√†ng th√°ng!
                                            </div>
                                        </div>
                                    )}
                                    {!freedomDay && (
                                        <div className="p-4 rounded-lg" style={{ backgroundColor: 'rgba(255, 255, 255, 0.1)' }}>
                                            <div className="text-sm" style={{ color: config.text_color || defaultConfig.text_color }}>
                                                üí° M·∫πo: TƒÉng v·ªën ƒë·∫ßu t∆∞ ho·∫∑c k√©o d√†i th·ªùi gian ƒë·ªÉ ƒë·∫°t ƒë∆∞·ª£c t·ª± do t√†i ch√≠nh!
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                        <div className="glass-effect rounded-2xl p-6">
                            <h2 className="text-2xl font-semibold mb-6" style={{ color: config.text_color || defaultConfig.text_color }}>
                                üìà Bi·ªÉu ƒë·ªì TƒÉng Tr∆∞·ªüng
                            </h2>
                            <div className="h-80 md:h-96">
                                <canvas ref={chartRef}></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<FinancialFreedomApp />, document.getElementById('root'));
    </script>
</body>
</html>
